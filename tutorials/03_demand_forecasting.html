<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pytimetk - Demand Forecasting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tutorials/04_anomaly_detection.html" rel="next">
<link href="../tutorials/02_finance.html" rel="prev">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=330861489"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '330861489', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.26.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>



<meta property="og:title" content="pytimetk - Demand Forecasting">
<meta property="og:description" content="">
<meta property="og:site-name" content="pytimetk">
<meta name="twitter:title" content="pytimetk - Demand Forecasting">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="https://www.business-science.io/img/business-science-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">pytimetk</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/business-science/pytimetk" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/01_sales_crm.html">üìò Applied Tutorials:</a></li><li class="breadcrumb-item"><a href="../tutorials/03_demand_forecasting.html">Demand Forecasting</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyTimeTK üìà</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">üèÅ Getting Started:</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/01_installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../getting-started/02_quick_start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">üó∫Ô∏è Guides:</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/01_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/02_timetk_concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyTimeTK Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/03_pandas_frequency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas Frequencies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/04_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/05_augmenting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Adding Features (Augmenting)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">üìò Applied Tutorials:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/01_sales_crm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sales CRM Database Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/02_finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finance and Investment Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/03_demand_forecasting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Demand Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/04_anomaly_detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/05_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üìÑ API Reference</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/business-science/pytimetk" class="sidebar-item-text sidebar-link">
 <span class="menu-text">‚≠ê PyTimeTK on Github</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üçª Contributing</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../changelog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üìß Change Log</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">üìö More References:</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.business-science.io/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Business Science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.quantscience.io/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quant Science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://business-science.github.io/timetk/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Timetk (R Version)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preprocessing-the-dataset" id="toc-preprocessing-the-dataset" class="nav-link active" data-scroll-target="#preprocessing-the-dataset"><span class="header-section-number">1</span> Preprocessing the dataset</a></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling"><span class="header-section-number">2</span> Modeling</a></li>
  <li><a href="#forecasting" id="toc-forecasting" class="nav-link" data-scroll-target="#forecasting"><span class="header-section-number">3</span> Forecasting</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">4</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/business-science/pytimetk/edit/main/tutorials/03_demand_forecasting.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/business-science/pytimetk/issues" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Demand Forecasting</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Timetk enables to generate features from the time column of your data very easily. This tutorial showcases how easy it is to perform time series forecasting with <code>pytimetk</code>. The specific methods we will be using are:</p>
<ul>
<li><code>tk.augment_timeseries_signature()</code>: Add 29 time series features to a DataFrame.</li>
<li><code>tk.plot_timeseries()</code>: Creates time series plots using different plotting engines such as Plotnine, Matplotlib, and Plotly.</li>
<li><code>tk.future_frame()</code>: Extend a DataFrame or GroupBy object with future dates.</li>
</ul>
<p>Load the following packages before proceeding with this tutorial.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytimetk <span class="im">as</span> tk</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> RobustScaler</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectKBest, mutual_info_regression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The tutorial is divided into three parts: We will first have a look at the Walmart dataset and perform some preprocessing. Secondly, we will create models based on different features, and see how the time features can be useful. Finally, we will solve the task of time series forecasting, using the features from augment_timeseries_signature only, in order to predict future sales.</p>
<section id="preprocessing-the-dataset" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Preprocessing the dataset</h1>
<p>The first thing we want to do is to load the dataset. It is a subset of the Walmart sales prediction Kaggle competition. You can get more insights about the dataset by following this link: <a href="https://business-science.github.io/timetk/reference/walmart_sales_weekly.html">walmart_sales_weekly</a>. The most important thing to know about the dataset is that you are provided with some features like the fuel price or whether the week contains holidays and you are expected to predict the weekly sales column for 7 different departments of a given store. Of course, you also have the date for each week, and that is what we can leverage to create additional features.</p>
<p>Let us start by loading the dataset and cleaning it. Note that we also remove markdown columns as they are not very useful for the tutorial.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We start by loading the dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># /walmart_sales_weekly.html</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>dset <span class="op">=</span> tk.load_dataset(<span class="st">'walmart_sales_weekly'</span>, parse_dates <span class="op">=</span> [<span class="st">'Date'</span>])</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>dset <span class="op">=</span> dset.drop(columns<span class="op">=</span>[</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'id'</span>, <span class="co"># This column can be removed as it is equivalent to 'Dept'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Store'</span>, <span class="co"># This column has only one possible value</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Type'</span>, <span class="co"># This column has only one possible value</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Size'</span>, <span class="co"># This column has only one possible value</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MarkDown1'</span>, <span class="st">'MarkDown2'</span>, <span class="st">'MarkDown3'</span>, <span class="st">'MarkDown4'</span>, <span class="st">'MarkDown5'</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>dset.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dept</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Weekly_Sales</th>
<th data-quarto-table-cell-role="th">IsHoliday</th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">Fuel_Price</th>
<th data-quarto-table-cell-role="th">CPI</th>
<th data-quarto-table-cell-role="th">Unemployment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2010-02-05</td>
<td>24924.50</td>
<td>False</td>
<td>42.31</td>
<td>2.572</td>
<td>211.096358</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2010-02-12</td>
<td>46039.49</td>
<td>True</td>
<td>38.51</td>
<td>2.548</td>
<td>211.242170</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2010-02-19</td>
<td>41595.55</td>
<td>False</td>
<td>39.93</td>
<td>2.514</td>
<td>211.289143</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>2010-02-26</td>
<td>19403.54</td>
<td>False</td>
<td>46.63</td>
<td>2.561</td>
<td>211.319643</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>2010-03-05</td>
<td>21827.90</td>
<td>False</td>
<td>46.50</td>
<td>2.625</td>
<td>211.350143</td>
<td>8.106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can plot the values of one department to get an idea of how the data looks like, using the <code>plot_timeseries</code> method:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sales_df <span class="op">=</span> dset</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sales_df[sales_df[<span class="st">'Dept'</span>]<span class="op">==</span><span class="dv">1</span>].plot_timeseries(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    date_column<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    value_column<span class="op">=</span><span class="st">'Weekly_Sales'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    facet_ncol <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    x_axis_date_labels <span class="op">=</span> <span class="st">"%Y"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    engine <span class="op">=</span> <span class="st">'plotly'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="df974a23-1c8e-4fe4-b1b6-caa779845528" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("df974a23-1c8e-4fe4-b1b6-caa779845528")) {                    Plotly.newPlot(                        "df974a23-1c8e-4fe4-b1b6-caa779845528",                        [{"line":{"color":"rgba(44, 62, 80, 1.0)","width":0.65},"mode":"lines","name":"Time Series","showlegend":false,"x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[24924.5,46039.49,41595.55,19403.54,21827.9,21043.39,22136.64,26229.21,57258.43,42960.91,17596.96,16145.35,16555.11,17413.94,18926.74,14773.04,15580.43,17558.09,16637.62,16216.27,16328.72,16333.14,17688.76,17150.84,15360.45,15381.82,17508.41,15536.4,15740.13,15793.87,16241.78,18194.74,19354.23,18122.52,20094.19,23388.03,26978.34,25543.04,38640.93,34238.88,19549.39,19552.84,18820.29,22517.56,31497.65,44912.86,55931.23,19124.58,15984.24,17359.7,17341.47,18461.18,21665.76,37887.17,46845.87,19363.83,20327.61,21280.4,20334.23,20881.1,20398.09,23873.79,28762.37,50510.31,41512.39,20138.19,17235.15,15136.78,15741.6,16434.15,15883.52,14978.09,15682.81,15363.5,16148.87,15654.85,15766.6,15922.41,15295.55,14539.79,14689.24,14537.37,15277.27,17746.68,18535.48,17859.3,18337.68,20797.58,23077.55,23351.8,31579.9,39886.06,18689.54,19050.66,20911.25,25293.49,33305.92,45773.03,46788.75,23350.88,16567.69,16894.4,18365.1,18378.16,23510.49,36988.49,54060.1,20124.22,20113.03,21140.07,22366.88,22107.7,28952.86,57592.12,34684.21,16976.19,16347.6,17147.44,18164.2,18517.79,16963.55,16065.49,17666.0,17558.82,16633.41,15722.82,17823.37,16566.18,16348.06,15731.18,16628.31,16119.92,17330.7,16286.4,16680.24,18322.37,19616.22,19251.5,18947.81,21904.47,22764.01,24185.27,27390.81],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"line":{"color":"rgba(51, 102, 255, 1.0)","width":1.0},"mode":"lines","name":"Smoother","showlegend":false,"x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[23418.999442444427,22971.325594724152,22527.496675520924,22087.28744851187,21650.66692396749,21218.39613299451,20791.543299062592,20371.31687710367,19958.476030195525,19552.671127540754,19152.817374567654,18757.201591466062,18364.605191488532,17976.713992544956,17670.5309639767,17378.554497688834,17108.823912951084,16883.34402465916,16719.37185780086,16615.383289977453,16561.739845216296,16546.62976914232,16566.005301045047,16626.408665291838,16734.04060624745,16893.565339645556,17104.825252014292,17364.800921149275,17662.927580643594,17977.831281075567,18283.56980064884,18565.926513378417,18830.851069467797,19094.421530337884,19364.36320663878,19622.803990279343,19835.7040579222,19972.54571401494,20028.07722053323,20028.39595239629,20013.69276652682,19994.259094169494,19955.313042433438,19884.36434023589,19781.652094899448,19656.75538477899,19527.304747394614,19419.27108260625,19357.186420899394,19346.649097069665,19373.07201970849,19421.82485733859,19487.450502509128,19583.54585643106,19711.966495697125,19832.325421895413,19890.10725043108,19864.95584135564,19772.149828651058,19639.14658034126,19480.12852184277,19289.611250840913,19060.77014133939,18794.579271393173,18502.16458846387,18200.694659349636,17901.10736332209,17597.92279505283,17278.44061321988,16939.900494741643,16602.427370992067,16298.258927052468,16058.947041413334,15903.668510029578,15831.786099906547,15833.814961033424,15901.9211579738,16034.913339706805,16226.892108324319,16470.653574987442,16751.93928216576,17055.206272188552,17369.57675402227,17693.263383079266,18029.67587944524,18385.672946478757,18766.736022193614,19165.36992759078,19548.239307456166,19867.8340457241,20088.446983834387,20212.603230264278,20285.455805956557,20341.670642568435,20385.82339780803,20412.952095490327,20423.216909062055,20420.419944829846,20408.6487621578,20392.85033647078,20383.75618442562,20392.582169427355,20415.91486461731,20430.003399432102,20408.105650297166,20339.833207173324,20227.47290369972,20085.714570233667,19932.56856032177,19780.774594176837,19638.699553032664,19511.097829011902,19387.670473421134,19243.48422989778,19057.461480399958,18829.407925269916,18571.848488009524,18301.651959608567,18031.500076839635,17762.151572363877,17502.881269517282,17276.067583527645,17104.35903289913,16995.102274158653,16939.974794796577,16925.316221577647,16941.85297882697,16992.038418299217,17082.362121722184,17220.79550449251,17544.000135967966,17900.434666169855,18267.967100463327,18641.842735627055,19021.321963691484,19406.912404015085,19799.70229334843,20200.944488783527,20611.858890381118,21033.764672044257,21468.086356964726,21915.856328395723,22377.508638029663],"type":"scatter","hoverlabel":{"font":{"size":8.8}}}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""},"tickformat":"%Y","showticklabels":true,"visible":true,"tickfont":{"size":8.8}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":""},"tickfont":{"size":8.8}},"legend":{"title":{"text":"Legend","font":{"size":8.8}},"font":{"size":8.8}},"title":{"text":"Time Series Plot","font":{"size":13.2}},"margin":{"l":10,"r":10,"t":40,"b":40},"font":{"size":11},"autosize":true},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('df974a23-1c8e-4fe4-b1b6-caa779845528');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Let us now reshape the DataFrame so that it has one column per Dept. This DataFrame represents our target variable y. We call it Y as it is a matrix, a stack of target variables, one for each Dept.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> sales_df[[<span class="st">'Dept'</span>, <span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]].set_index([<span class="st">'Dept'</span>, <span class="st">'Date'</span>]).sort_index().unstack([<span class="st">'Dept'</span>])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Y.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="7" data-quarto-table-cell-role="th" data-halign="left">Weekly_Sales</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Dept</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">13</th>
<th data-quarto-table-cell-role="th">38</th>
<th data-quarto-table-cell-role="th">93</th>
<th data-quarto-table-cell-role="th">95</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-02-05</td>
<td>24924.50</td>
<td>13740.12</td>
<td>40129.01</td>
<td>41969.29</td>
<td>115564.35</td>
<td>64494.87</td>
<td>106690.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-02-12</td>
<td>46039.49</td>
<td>10887.84</td>
<td>37334.83</td>
<td>36476.40</td>
<td>94136.35</td>
<td>70202.02</td>
<td>111390.36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-02-19</td>
<td>41595.55</td>
<td>11523.47</td>
<td>38717.60</td>
<td>37857.68</td>
<td>98672.59</td>
<td>62581.64</td>
<td>107952.07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-02-26</td>
<td>19403.54</td>
<td>11135.17</td>
<td>35318.20</td>
<td>37467.32</td>
<td>92755.59</td>
<td>57630.02</td>
<td>103652.58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-03-05</td>
<td>21827.90</td>
<td>12275.58</td>
<td>38776.09</td>
<td>40423.95</td>
<td>108282.86</td>
<td>63550.08</td>
<td>112807.75</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now that we have our target, we want to produce the features that will help us predict the target. We will create two sets of features, to show the differences between time features and the original features provided with the dataset.</p>
<p><code>X</code> contains the features originally in the dataset:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sales_df.drop_duplicates(subset<span class="op">=</span>[<span class="st">'Date'</span>]).drop(columns<span class="op">=</span>[<span class="st">'Dept'</span>, <span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">IsHoliday</th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">Fuel_Price</th>
<th data-quarto-table-cell-role="th">CPI</th>
<th data-quarto-table-cell-role="th">Unemployment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>42.31</td>
<td>2.572</td>
<td>211.096358</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True</td>
<td>38.51</td>
<td>2.548</td>
<td>211.242170</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False</td>
<td>39.93</td>
<td>2.514</td>
<td>211.289143</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False</td>
<td>46.63</td>
<td>2.561</td>
<td>211.319643</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>46.50</td>
<td>2.625</td>
<td>211.350143</td>
<td>8.106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>X_time</code> contains the time features. To build it we first apply the <code>augment_timeseries_signature</code> method on the <code>Date</code> column. Then, we create dummy variables from the categorical features that have been created, so that they can be fed in a machine learning algorithm.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dummify(X_time: pd.DataFrame, date_col <span class="op">=</span> <span class="st">'Date'</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">""" Creates dummy variables from the categorical date features that have been created. """</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  X_time <span class="op">=</span> pd.get_dummies(X_time, columns<span class="op">=</span>[</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_year'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_year_iso'</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_quarteryear'</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_month_lbl'</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_wday_lbl'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f'</span><span class="sc">{</span>date_col<span class="sc">}</span><span class="ss">_am_pm'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> X_time</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>date_col <span class="op">=</span> <span class="st">'Date'</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>X_time <span class="op">=</span> sales_df[[<span class="st">'Date'</span>]].drop_duplicates(subset<span class="op">=</span>[date_col]).augment_timeseries_signature(date_column <span class="op">=</span> date_col).drop(columns<span class="op">=</span>[date_col])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>X_time <span class="op">=</span> dummify(X_time, date_col<span class="op">=</span>date_col)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>X_time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date_index_num</th>
<th data-quarto-table-cell-role="th">Date_yearstart</th>
<th data-quarto-table-cell-role="th">Date_yearend</th>
<th data-quarto-table-cell-role="th">Date_leapyear</th>
<th data-quarto-table-cell-role="th">Date_half</th>
<th data-quarto-table-cell-role="th">Date_quarter</th>
<th data-quarto-table-cell-role="th">Date_quarterstart</th>
<th data-quarto-table-cell-role="th">Date_quarterend</th>
<th data-quarto-table-cell-role="th">Date_month</th>
<th data-quarto-table-cell-role="th">Date_monthstart</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_December</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_February</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_January</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_July</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_June</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_March</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_May</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_November</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_October</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_September</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1265328000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1265932800</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1266537600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1267142400</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1267747200</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">138</td>
<td>1348790400</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>9</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">139</td>
<td>1349395200</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">140</td>
<td>1350000000</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">141</td>
<td>1350604800</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>1351209600</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>143 rows √ó 49 columns</p>
</div>
</div>
</div>
<p>Let us explain a little bit more what happened here. We select only the Date column with</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sales_df[[<span class="st">'Date'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2010-02-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2010-02-12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2010-02-19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2010-02-26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2010-03-05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">996</td>
<td>2012-09-28</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">997</td>
<td>2012-10-05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">998</td>
<td>2012-10-12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999</td>
<td>2012-10-19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000</td>
<td>2012-10-26</td>
</tr>
</tbody>
</table>

<p>1001 rows √ó 1 columns</p>
</div>
</div>
</div>
<p>We then drop the duplicates, as the Date column contains all the dates 7 times (one for each Dept):</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sales_df.drop_duplicates(subset<span class="op">=</span>[date_col])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dept</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Weekly_Sales</th>
<th data-quarto-table-cell-role="th">IsHoliday</th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">Fuel_Price</th>
<th data-quarto-table-cell-role="th">CPI</th>
<th data-quarto-table-cell-role="th">Unemployment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2010-02-05</td>
<td>24924.50</td>
<td>False</td>
<td>42.31</td>
<td>2.572</td>
<td>211.096358</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2010-02-12</td>
<td>46039.49</td>
<td>True</td>
<td>38.51</td>
<td>2.548</td>
<td>211.242170</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2010-02-19</td>
<td>41595.55</td>
<td>False</td>
<td>39.93</td>
<td>2.514</td>
<td>211.289143</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>2010-02-26</td>
<td>19403.54</td>
<td>False</td>
<td>46.63</td>
<td>2.561</td>
<td>211.319643</td>
<td>8.106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>2010-03-05</td>
<td>21827.90</td>
<td>False</td>
<td>46.50</td>
<td>2.625</td>
<td>211.350143</td>
<td>8.106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">138</td>
<td>1</td>
<td>2012-09-28</td>
<td>18947.81</td>
<td>False</td>
<td>76.08</td>
<td>3.666</td>
<td>222.981658</td>
<td>6.908</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">139</td>
<td>1</td>
<td>2012-10-05</td>
<td>21904.47</td>
<td>False</td>
<td>68.55</td>
<td>3.617</td>
<td>223.181477</td>
<td>6.573</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">140</td>
<td>1</td>
<td>2012-10-12</td>
<td>22764.01</td>
<td>False</td>
<td>62.99</td>
<td>3.601</td>
<td>223.381296</td>
<td>6.573</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">141</td>
<td>1</td>
<td>2012-10-19</td>
<td>24185.27</td>
<td>False</td>
<td>67.97</td>
<td>3.594</td>
<td>223.425723</td>
<td>6.573</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>1</td>
<td>2012-10-26</td>
<td>27390.81</td>
<td>False</td>
<td>69.16</td>
<td>3.506</td>
<td>223.444251</td>
<td>6.573</td>
</tr>
</tbody>
</table>

<p>143 rows √ó 8 columns</p>
</div>
</div>
</div>
<p>We can now augment the data using <code>tk.augment_timeseries_signature</code>, and drop the original Date column:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sales_df.augment_timeseries_signature(date_column <span class="op">=</span> date_col).drop(columns<span class="op">=</span>[date_col])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dept</th>
<th data-quarto-table-cell-role="th">Weekly_Sales</th>
<th data-quarto-table-cell-role="th">IsHoliday</th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">Fuel_Price</th>
<th data-quarto-table-cell-role="th">CPI</th>
<th data-quarto-table-cell-role="th">Unemployment</th>
<th data-quarto-table-cell-role="th">Date_index_num</th>
<th data-quarto-table-cell-role="th">Date_year</th>
<th data-quarto-table-cell-role="th">Date_year_iso</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Date_mday</th>
<th data-quarto-table-cell-role="th">Date_qday</th>
<th data-quarto-table-cell-role="th">Date_yday</th>
<th data-quarto-table-cell-role="th">Date_weekend</th>
<th data-quarto-table-cell-role="th">Date_hour</th>
<th data-quarto-table-cell-role="th">Date_minute</th>
<th data-quarto-table-cell-role="th">Date_second</th>
<th data-quarto-table-cell-role="th">Date_msecond</th>
<th data-quarto-table-cell-role="th">Date_nsecond</th>
<th data-quarto-table-cell-role="th">Date_am_pm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>24924.50</td>
<td>False</td>
<td>42.31</td>
<td>2.572</td>
<td>211.096358</td>
<td>8.106</td>
<td>1265328000</td>
<td>2010</td>
<td>2010</td>
<td>...</td>
<td>5</td>
<td>36</td>
<td>36</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>46039.49</td>
<td>True</td>
<td>38.51</td>
<td>2.548</td>
<td>211.242170</td>
<td>8.106</td>
<td>1265932800</td>
<td>2010</td>
<td>2010</td>
<td>...</td>
<td>12</td>
<td>43</td>
<td>43</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>41595.55</td>
<td>False</td>
<td>39.93</td>
<td>2.514</td>
<td>211.289143</td>
<td>8.106</td>
<td>1266537600</td>
<td>2010</td>
<td>2010</td>
<td>...</td>
<td>19</td>
<td>50</td>
<td>50</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>19403.54</td>
<td>False</td>
<td>46.63</td>
<td>2.561</td>
<td>211.319643</td>
<td>8.106</td>
<td>1267142400</td>
<td>2010</td>
<td>2010</td>
<td>...</td>
<td>26</td>
<td>57</td>
<td>57</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>21827.90</td>
<td>False</td>
<td>46.50</td>
<td>2.625</td>
<td>211.350143</td>
<td>8.106</td>
<td>1267747200</td>
<td>2010</td>
<td>2010</td>
<td>...</td>
<td>5</td>
<td>64</td>
<td>64</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">996</td>
<td>95</td>
<td>115326.47</td>
<td>False</td>
<td>76.08</td>
<td>3.666</td>
<td>222.981658</td>
<td>6.908</td>
<td>1348790400</td>
<td>2012</td>
<td>2012</td>
<td>...</td>
<td>28</td>
<td>90</td>
<td>272</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">997</td>
<td>95</td>
<td>127009.22</td>
<td>False</td>
<td>68.55</td>
<td>3.617</td>
<td>223.181477</td>
<td>6.573</td>
<td>1349395200</td>
<td>2012</td>
<td>2012</td>
<td>...</td>
<td>5</td>
<td>5</td>
<td>279</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">998</td>
<td>95</td>
<td>124559.93</td>
<td>False</td>
<td>62.99</td>
<td>3.601</td>
<td>223.381296</td>
<td>6.573</td>
<td>1350000000</td>
<td>2012</td>
<td>2012</td>
<td>...</td>
<td>12</td>
<td>12</td>
<td>286</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">999</td>
<td>95</td>
<td>123346.24</td>
<td>False</td>
<td>67.97</td>
<td>3.594</td>
<td>223.425723</td>
<td>6.573</td>
<td>1350604800</td>
<td>2012</td>
<td>2012</td>
<td>...</td>
<td>19</td>
<td>19</td>
<td>293</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1000</td>
<td>95</td>
<td>117375.38</td>
<td>False</td>
<td>69.16</td>
<td>3.506</td>
<td>223.444251</td>
<td>6.573</td>
<td>1351209600</td>
<td>2012</td>
<td>2012</td>
<td>...</td>
<td>26</td>
<td>26</td>
<td>300</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>am</td>
</tr>
</tbody>
</table>

<p>1001 rows √ó 36 columns</p>
</div>
</div>
</div>
</section>
<section id="modeling" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Modeling</h1>
<p>So far, we defined our target variables <code>Y</code>, and two different sets of features: <code>X</code> and <code>X_time</code>. We can now train a sales forecasting model. For this tutorial we will be using the RandomForestsRegressor, as it is a simple yet powerful model, that can handle multiple types of data. We build a train function that takes the features and the targets as input, and is composed of several steps:</p>
<ol type="1">
<li>We divide the data into a train set and a test set. <code>train_size</code> is the percentage of the data that you want to keep for the train set, the rest will be used for the test set.</li>
<li>We scale numerical features if any, so that the model learns better. The <code>RobustScaler</code> allows for better performances, as it scales the data using statistics that are robust to outliers.</li>
<li>We added the <code>k</code> option so that we can select the k best features of our dataset using mutual information, hence reducing the noise of irrelevant features.</li>
<li>We train and test the RandomForests model, measuring its performance with the R2 score function.</li>
</ol>
<p>The resulting training function is as follows:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(X, Y, k<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">""" Trains a RandomForests model on the input data. """</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  Y <span class="op">=</span> Y.fillna(method<span class="op">=</span><span class="st">'ffill'</span>).fillna(method<span class="op">=</span><span class="st">'bfill'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  X_train, X_test, Y_train, Y_test <span class="op">=</span> train_test_split(X, Y, shuffle<span class="op">=</span><span class="va">False</span>, train_size<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale numerical features</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  features_to_scale <span class="op">=</span> [ c <span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'Temperature'</span>, <span class="st">'Fuel_Price'</span>, <span class="st">'CPI'</span>, <span class="st">'Unemployment'</span>] <span class="cf">if</span> c <span class="kw">in</span> X.columns]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(features_to_scale):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> RobustScaler()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    X_train[features_to_scale] <span class="op">=</span> scaler.fit_transform(X_train[features_to_scale])</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    X_test[features_to_scale] <span class="op">=</span> scaler.transform(X_test[features_to_scale])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select best features to remove noise</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> k <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    selector <span class="op">=</span> SelectKBest(mutual_info_regression, k<span class="op">=</span>k)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> selector.fit_transform(X_train, Y_train.iloc[:,<span class="dv">1</span>])</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> selector.transform(X_test)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># train the model</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">123456</span>, n_estimators<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> model.fit(X_train, Y_train)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  preds_train <span class="op">=</span> model.predict(X_train)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test the model</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  preds_test <span class="op">=</span> model.predict(X_test)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f'R2 score: </span><span class="sc">{</span>r2_score(Y_test, preds_test)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Y_train, Y_test, preds_train, preds_test  <span class="co"># returns data useful for the plot_result function below</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition, we define a plot function based on <code>tk.plot_timeseries</code> that will enable us to compare the ground truth data to the model‚Äôs predictions, for a given department.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_result(dept_idx, Y, Y_train, Y_test, preds_train, preds_test):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">""" Plots the predictions for a given Department. """</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Weekly_Sales'</span>: pd.concat([</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>          Y.iloc[:, dept_idx],</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>          pd.Series(preds_train[:,dept_idx], index<span class="op">=</span>Y_train.index),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>          pd.Series(preds_test[:,dept_idx], index<span class="op">=</span>Y_test.index)])</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">'Labels'</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">'Labels'</span>].iloc[:<span class="bu">len</span>(Y)] <span class="op">=</span> <span class="st">'Ground truth'</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">'Labels'</span>].iloc[<span class="bu">len</span>(Y):<span class="bu">len</span>(Y)<span class="op">+</span><span class="bu">len</span>(Y_train)] <span class="op">=</span> <span class="st">'Predictions on train set'</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">'Labels'</span>].iloc[<span class="bu">len</span>(Y)<span class="op">+</span><span class="bu">len</span>(Y_train):] <span class="op">=</span> <span class="st">'Predictions on test set'</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  fig <span class="op">=</span> data.reset_index().plot_timeseries(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    date_column<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    value_column<span class="op">=</span><span class="st">'Weekly_Sales'</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    color_column<span class="op">=</span><span class="st">'Labels'</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    facet_ncol <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    smooth<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    x_axis_date_labels <span class="op">=</span> <span class="st">"%Y"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    engine <span class="op">=</span> <span class="st">'plotly'</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we train using the <code>X</code> matrix of features (the features of the dataset) we get a poor result with a R2 score of -0.16.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Y_train, Y_test, preds_train, preds_test <span class="op">=</span> train(X, Y)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plot_result(<span class="dv">1</span>, Y, Y_train, Y_test, preds_train, preds_test)  <span class="co"># We inspect the predictions for the first department</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 score: -0.16021915207983892</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>                            <div id="9c483e6e-99ef-4008-ad29-e5d5531c9b8c" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("9c483e6e-99ef-4008-ad29-e5d5531c9b8c")) {                    Plotly.newPlot(                        "9c483e6e-99ef-4008-ad29-e5d5531c9b8c",                        [{"legendgroup":"Predictions on test set","line":{"color":"rgba(24, 188, 156, 1.0)","width":0.65},"mode":"lines","name":"Predictions on test set","x":["2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[30752.07683333326,8673.12996666665,31907.65229999993,32897.558333333254,26130.79413333327,32808.53859999992,27673.352699999967,26087.625133333273,26064.76659999994,26077.214499999944,26074.25163333328,26081.580499999945,8756.760599999992,8544.641866666658,8640.184233333326,8559.052866666658,9306.327033333337,8965.407933333347,9767.197199999986,9575.524999999998,10196.238466666675,9848.107400000003,9687.796566666659,10100.684966666679,10750.489100000003,10968.68803333333,10616.87756666667,10827.091366666662,10630.254433333335,10833.171633333326,10714.98673333333,10143.589533333336,10130.65726666667,10085.87656666666,10359.09603333333,10636.889299999983,9796.985233333317,9647.635466666656,9674.11876666665,9615.091766666648,9503.82053333331,9296.607033333317,8841.252633333328,9160.60879999999,9366.088899999973,9298.914833333323,8508.848599999985,8506.378700000007,8865.685300000006,8437.942799999986,8444.407566666652,8537.367366666651,8552.76706666665,8561.563666666652,27388.067899999958,9025.830499999985,8456.890666666655,8545.361566666652,8710.013099999987,31155.373566666593,28441.21983333329,27363.395966666623,8419.777833333319,8509.655066666652,9103.186733333325,8521.500066666653,8816.185000000007,8464.536066666653,9482.395033333338,9625.777233333312,9529.946399999999,9131.082433333333],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Ground truth","line":{"color":"rgba(44, 62, 80, 1.0)","width":0.65},"mode":"lines","name":"Ground truth","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[13740.12,10887.84,11523.47,11135.17,12275.58,10123.45,9001.37,10366.85,11157.08,10179.29,9226.8,8868.93,9337.44,9372.8,7919.86,7813.91,8412.69,8001.41,7742.75,8201.06,6591.22,7857.88,8112.67,13751.3,16930.62,20915.95,26719.02,30640.54,41101.93,51159.17,19081.8,12134.69,10722.46,8097.92,9775.17,10081.8,9735.73,8614.41,9283.09,9825.22,9146.77,9202.11,10706.81,10856.85,11219.78,11986.84,12080.36,8266.14,15808.15,13275.87,12532.94,11983.34,11012.52,11428.25,11724.98,10473.78,11039.12,10689.97,8148.69,9049.02,8734.19,10417.33,8212.97,8468.72,8653.62,10420.92,8732.46,7939.01,8120.7,8853.89,7508.71,7658.75,6165.73,8070.64,7366.5,11578.11,16069.5,21331.51,31248.98,32148.93,41603.11,49775.52,19604.47,12778.28,10412.88,9755.56,10434.83,9977.96,9870.22,10136.78,9421.2,9189.2,9959.64,10104.36,9317.56,10146.54,12955.55,13180.05,13667.88,8848.44,13926.04,13822.49,11702.08,10613.17,12485.78,12388.85,10237.78,10502.4,11387.31,11925.71,8845.73,7910.22,9129.23,9335.24,7927.73,8647.36,8635.62,10655.35,10342.72,8609.82,8345.33,7175.77,8614.64,8016.26,7301.41,7577.59,8473.71,13126.15,20126.95,22716.7,30331.69,28257.3,31905.97,43712.78,50701.3,18368.51,14288.22,13403.63,13085.95,11676.98,10487.17,8548.87,9350.9],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Predictions on train set","line":{"color":"rgba(227, 26, 28, 1.0)","width":0.65},"mode":"lines","name":"Predictions on train set","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00"],"y":[12942.300366666728,11263.297233333325,11575.002466666709,11449.198433333322,11820.466400000032,10320.4502666667,9685.318333333391,10438.316833333385,10619.670666666703,9801.349533333349,9324.591133333326,9132.97383333335,9361.560199999967,9136.680333333325,8281.887733333344,8182.383766666663,8480.101733333306,8191.933499999984,8378.931266666657,10481.174166666704,10169.836733333363,8836.532899999955,9201.806033333301,13331.141766666631,14960.579066666696,16793.681633333388,31762.574799999817,30474.891866666592,36862.635733333176,39696.19069999994,16193.817233333262,12279.850899999954,13333.386466666632,10893.928933333293,9763.032299999975,10076.308699999981,9530.995499999992,8872.920600000001,9234.6201,9796.246966666697,9352.675766666685,9870.67726666667,10257.837300000017,10745.3465666667,11440.594933333288,11802.05899999997,11638.956433333313,10014.409833333322,14074.87366666662,12853.33000000004,12260.106733333298,11953.624733333301,11330.90610000001,11193.894433333335,11260.874866666662,10307.595799999966,10576.956866666706,10461.77206666669,8947.85543333331,9043.592066666679,9232.394299999978,9814.695300000027,8418.337100000019,8492.130400000018,8621.241966666708,9746.218966666625,8651.601233333313,8546.681199999974,8306.268599999994,8718.807266666656,8166.867699999975],"type":"scatter","hoverlabel":{"font":{"size":8.8}}}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""},"tickformat":"%Y","showticklabels":true,"visible":true,"tickfont":{"size":8.8}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":""},"tickfont":{"size":8.8}},"legend":{"title":{"text":"Legend","font":{"size":8.8}},"font":{"size":8.8}},"title":{"text":"Time Series Plot","font":{"size":13.2}},"margin":{"l":10,"r":10,"t":40,"b":40},"font":{"size":11},"autosize":true},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('9c483e6e-99ef-4008-ad29-e5d5531c9b8c');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Computing the mutual information score on these features, we realize that only two features are really useful. But using them alone does not improve the results.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> mutual_info_regression</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_MI(X, Y):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  Y <span class="op">=</span> Y.fillna(method<span class="op">=</span><span class="st">'ffill'</span>).fillna(method<span class="op">=</span><span class="st">'bfill'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  X_train, X_test, Y_train, Y_test <span class="op">=</span> train_test_split(X, Y, shuffle<span class="op">=</span><span class="va">False</span>, train_size<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  features_to_scale <span class="op">=</span> [ c <span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'Temperature'</span>, <span class="st">'Fuel_Price'</span>, <span class="st">'CPI'</span>, <span class="st">'Unemployment'</span>] <span class="cf">if</span> c <span class="kw">in</span> X.columns]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  scaler <span class="op">=</span> RobustScaler()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  X_train[features_to_scale] <span class="op">=</span> scaler.fit_transform(X_train[features_to_scale])</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(pd.DataFrame({<span class="st">'feature'</span>: X_train.columns, <span class="st">'MI'</span>: mutual_info_regression(X_train, Y_train.iloc[:,<span class="dv">0</span>])}).sort_values(by<span class="op">=</span><span class="st">'MI'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>compute_MI(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        feature        MI
1   Temperature  0.277781
4  Unemployment  0.215075
2    Fuel_Price  0.080510
0     IsHoliday  0.004462
3           CPI  0.003706</code></pre>
</div>
</div>
<p>Output:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>        feature        MI</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   Temperature  <span class="fl">0.277781</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Unemployment  <span class="fl">0.213034</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Fuel_Price  <span class="fl">0.080510</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     IsHoliday  <span class="fl">0.004462</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>           CPI  <span class="fl">0.003706</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now if we create a model using our date-based features, the results are a lot better, with a R2 score of .23 !</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Y_train, Y_test, preds_train, preds_test <span class="op">=</span> train(X_time, Y)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plot_result(<span class="dv">1</span>, Y, Y_train, Y_test, preds_train, preds_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 score: 0.23031249715453514</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>                            <div id="deb866fd-f6be-4e7b-91ef-52047e3fb9ff" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("deb866fd-f6be-4e7b-91ef-52047e3fb9ff")) {                    Plotly.newPlot(                        "deb866fd-f6be-4e7b-91ef-52047e3fb9ff",                        [{"legendgroup":"Predictions on test set","line":{"color":"rgba(24, 188, 156, 1.0)","width":0.65},"mode":"lines","name":"Predictions on test set","x":["2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[8176.728899999981,8488.495599999998,9179.41479999998,9017.388133333323,8659.32919999999,9328.924866666679,9737.307400000022,17828.64639999996,17977.28739999999,21841.841266666615,27332.569866666643,10090.010266666659,9056.615066666649,8628.535799999981,9068.716699999999,9275.02856666667,9809.530499999984,8912.264966666655,9144.765866666667,9222.136500000015,9571.339299999998,9024.96493333333,8974.62626666666,9516.240166666681,9643.1396,9369.16889999998,9571.434233333315,10129.012233333333,9362.987000000005,10777.13713333333,9931.130800000006,9996.637999999988,9977.004366666672,10091.725133333333,9854.130199999998,9557.445399999986,9359.521399999996,9709.104666666672,9340.577766666662,8744.249866666649,8955.549066666666,9431.768166666674,9919.058633333329,8994.415033333327,9106.80296666666,9373.269066666682,9589.710599999986,8906.599066666651,8511.742933333315,8926.275133333333,8801.297233333325,8235.587499999981,8127.500333333315,8578.870499999995,9092.730266666671,9764.348766666653,8855.859033333318,9419.403733333329,9832.585433333355,17547.359333333305,18008.822633333326,20880.927333333297,27365.701599999968,27029.90146666663,9820.109833333316,8800.388833333316,9028.47159999999,9080.893133333338,9848.834699999989,8853.776033333319,8900.491099999988,9192.715933333346],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Ground truth","line":{"color":"rgba(44, 62, 80, 1.0)","width":0.65},"mode":"lines","name":"Ground truth","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[13740.12,10887.84,11523.47,11135.17,12275.58,10123.45,9001.37,10366.85,11157.08,10179.29,9226.8,8868.93,9337.44,9372.8,7919.86,7813.91,8412.69,8001.41,7742.75,8201.06,6591.22,7857.88,8112.67,13751.3,16930.62,20915.95,26719.02,30640.54,41101.93,51159.17,19081.8,12134.69,10722.46,8097.92,9775.17,10081.8,9735.73,8614.41,9283.09,9825.22,9146.77,9202.11,10706.81,10856.85,11219.78,11986.84,12080.36,8266.14,15808.15,13275.87,12532.94,11983.34,11012.52,11428.25,11724.98,10473.78,11039.12,10689.97,8148.69,9049.02,8734.19,10417.33,8212.97,8468.72,8653.62,10420.92,8732.46,7939.01,8120.7,8853.89,7508.71,7658.75,6165.73,8070.64,7366.5,11578.11,16069.5,21331.51,31248.98,32148.93,41603.11,49775.52,19604.47,12778.28,10412.88,9755.56,10434.83,9977.96,9870.22,10136.78,9421.2,9189.2,9959.64,10104.36,9317.56,10146.54,12955.55,13180.05,13667.88,8848.44,13926.04,13822.49,11702.08,10613.17,12485.78,12388.85,10237.78,10502.4,11387.31,11925.71,8845.73,7910.22,9129.23,9335.24,7927.73,8647.36,8635.62,10655.35,10342.72,8609.82,8345.33,7175.77,8614.64,8016.26,7301.41,7577.59,8473.71,13126.15,20126.95,22716.7,30331.69,28257.3,31905.97,43712.78,50701.3,18368.51,14288.22,13403.63,13085.95,11676.98,10487.17,8548.87,9350.9],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Predictions on train set","line":{"color":"rgba(227, 26, 28, 1.0)","width":0.65},"mode":"lines","name":"Predictions on train set","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00"],"y":[12943.602866666732,11296.46463333333,11048.00786666671,11116.859733333324,11763.527566666711,10468.688800000036,9506.495700000054,10145.51313333338,11106.750066666704,10151.043800000021,9541.286,9126.38293333335,9879.098766666644,9558.162466666652,8445.688666666678,8251.358033333328,9201.453633333307,8728.603800000003,8177.993700000003,8348.370033333362,7370.0054666666565,9763.356733333283,8926.5682333333,12770.989633333287,14657.74370000005,18141.650166666746,26363.09906666654,28377.966066666657,36819.939733333194,42483.90073333325,17028.41056666661,13090.35503333329,12003.070433333303,10703.398766666643,10699.168933333287,10300.319333333306,9931.628533333316,9551.542800000016,9736.402133333335,10198.629466666704,9472.684933333354,9827.636433333339,10297.956666666687,10890.090800000033,11018.590499999964,11320.86489999997,11195.22659999999,9249.038366666664,14350.852366666639,12983.692100000044,12100.37323333331,11665.983166666645,11352.557866666682,11374.302233333343,11267.565399999994,10373.189899999972,10841.426600000044,10495.553033333365,9195.062633333315,9408.555233333336,9362.55753333331,10174.978300000028,8643.630666666677,8791.622166666686,9103.65890000005,10112.569133333305,8926.093099999978,8368.661499999973,8404.97576666667,8902.473633333328,8020.056533333312],"type":"scatter","hoverlabel":{"font":{"size":8.8}}}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""},"tickformat":"%Y","showticklabels":true,"visible":true,"tickfont":{"size":8.8}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":""},"tickfont":{"size":8.8}},"legend":{"title":{"text":"Legend","font":{"size":8.8}},"font":{"size":8.8}},"title":{"text":"Time Series Plot","font":{"size":13.2}},"margin":{"l":10,"r":10,"t":40,"b":40},"font":{"size":11},"autosize":true},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('deb866fd-f6be-4e7b-91ef-52047e3fb9ff');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>Concatenating all the features together, we can get a little bit of improvement, but not a significant one (R2 score: 0.239).</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>X_concat <span class="op">=</span> pd.concat([X_time, X[[<span class="st">'Temperature'</span>, <span class="st">'Unemployment'</span>]]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Y_train, Y_test, preds_train, preds_test <span class="op">=</span> train(X_concat, Y, k<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>plot_result(<span class="dv">1</span>, Y, Y_train, Y_test, preds_train, preds_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 score: 0.23974542401432444</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>                            <div id="ae192a03-f025-410e-91b5-afab32d2e003" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("ae192a03-f025-410e-91b5-afab32d2e003")) {                    Plotly.newPlot(                        "ae192a03-f025-410e-91b5-afab32d2e003",                        [{"legendgroup":"Predictions on test set","line":{"color":"rgba(24, 188, 156, 1.0)","width":0.65},"mode":"lines","name":"Predictions on test set","x":["2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[14469.916766666674,9259.29086666668,14461.256099999988,14656.41509999999,14904.9321,18448.016600000014,18022.00870000003,20269.46523333327,20816.816099999978,24788.27626666662,27809.408966666637,16138.65909999996,10010.097666666648,9441.277199999984,10091.079000000009,11586.61300000002,9931.554499999991,9052.824399999994,9231.811699999987,9271.198833333337,10038.110833333345,9694.955733333336,9333.938966666658,9822.525000000007,10298.880133333347,10561.601333333329,10606.32623333331,10639.641333333326,9884.410666666667,12224.540233333326,11614.01740000001,10608.881299999981,10104.754266666667,10525.988566666676,10782.38313333334,10708.52143333333,9802.256399999991,9900.298866666672,10110.135566666675,8828.25029999999,9095.90986666667,9289.242233333352,9708.5935,9045.580700000002,8651.698433333315,8988.015900000015,9192.855099999982,8782.824833333325,8506.852633333316,8482.784699999997,8877.707899999985,8323.166166666646,8444.885833333317,8626.472833333333,17282.587966666702,9726.584999999986,9387.106533333314,10173.735566666659,11486.996033333364,21609.118799999946,22802.723799999978,25447.994933333295,21859.599533333338,23192.927200000006,11796.044833333312,9674.412433333317,9090.908533333317,10620.425333333345,10266.148366666659,9285.467933333324,9045.434533333315,9149.54523333334],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Ground truth","line":{"color":"rgba(44, 62, 80, 1.0)","width":0.65},"mode":"lines","name":"Ground truth","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[13740.12,10887.84,11523.47,11135.17,12275.58,10123.45,9001.37,10366.85,11157.08,10179.29,9226.8,8868.93,9337.44,9372.8,7919.86,7813.91,8412.69,8001.41,7742.75,8201.06,6591.22,7857.88,8112.67,13751.3,16930.62,20915.95,26719.02,30640.54,41101.93,51159.17,19081.8,12134.69,10722.46,8097.92,9775.17,10081.8,9735.73,8614.41,9283.09,9825.22,9146.77,9202.11,10706.81,10856.85,11219.78,11986.84,12080.36,8266.14,15808.15,13275.87,12532.94,11983.34,11012.52,11428.25,11724.98,10473.78,11039.12,10689.97,8148.69,9049.02,8734.19,10417.33,8212.97,8468.72,8653.62,10420.92,8732.46,7939.01,8120.7,8853.89,7508.71,7658.75,6165.73,8070.64,7366.5,11578.11,16069.5,21331.51,31248.98,32148.93,41603.11,49775.52,19604.47,12778.28,10412.88,9755.56,10434.83,9977.96,9870.22,10136.78,9421.2,9189.2,9959.64,10104.36,9317.56,10146.54,12955.55,13180.05,13667.88,8848.44,13926.04,13822.49,11702.08,10613.17,12485.78,12388.85,10237.78,10502.4,11387.31,11925.71,8845.73,7910.22,9129.23,9335.24,7927.73,8647.36,8635.62,10655.35,10342.72,8609.82,8345.33,7175.77,8614.64,8016.26,7301.41,7577.59,8473.71,13126.15,20126.95,22716.7,30331.69,28257.3,31905.97,43712.78,50701.3,18368.51,14288.22,13403.63,13085.95,11676.98,10487.17,8548.87,9350.9],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Predictions on train set","line":{"color":"rgba(227, 26, 28, 1.0)","width":0.65},"mode":"lines","name":"Predictions on train set","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00"],"y":[13031.881733333395,11248.361399999994,11078.641933333378,11032.440499999993,12053.395633333383,10406.187533333363,9533.738700000056,10254.13053333338,10985.701200000038,10091.965266666688,9438.4833,8994.836000000014,9692.631899999978,9370.060333333317,8354.539766666678,8253.948499999999,9383.338133333302,8435.856833333335,8013.4936999999945,8866.406700000025,9099.758000000023,10051.332566666613,9060.524933333296,13090.747399999953,14790.659266666715,18137.3930333334,27043.668766666535,28423.102966666644,37137.990099999864,41770.282099999924,17058.113633333265,12864.386899999954,12575.072899999968,11611.453366666641,10468.028133333302,10150.73103333331,9857.834899999989,9154.595433333343,9674.197533333336,10141.22753333337,9495.10226666668,9822.013300000006,10243.402166666692,10805.233900000036,11074.6542333333,11396.614033333299,11275.975499999984,9391.937633333331,14373.129633333301,12927.434800000048,12216.868066666633,11665.978899999971,11273.850733333344,11480.454266666677,11377.446399999997,10419.14739999997,10723.376233333374,10851.234300000038,9075.002866666648,9299.026333333346,9464.350499999986,10024.488966666697,8578.352633333343,8603.080266666684,8900.060666666717,10054.1647333333,8783.943033333313,8223.641866666645,8776.214666666667,8923.085899999995,8151.294366666645],"type":"scatter","hoverlabel":{"font":{"size":8.8}}}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""},"tickformat":"%Y","showticklabels":true,"visible":true,"tickfont":{"size":8.8}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":""},"tickfont":{"size":8.8}},"legend":{"title":{"text":"Legend","font":{"size":8.8}},"font":{"size":8.8}},"title":{"text":"Time Series Plot","font":{"size":13.2}},"margin":{"l":10,"r":10,"t":40,"b":40},"font":{"size":11},"autosize":true},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('ae192a03-f025-410e-91b5-afab32d2e003');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>This section showed the relevance of the time features in time series forecasting. Now let us build our final forecasting engine, using only the time-based features.</p>
</section>
<section id="forecasting" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Forecasting</h1>
<p>We want to use all of our data to create the final model. To that aim, we will use a very simplified version of our previous training function:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_final(X, Y):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">""" Trains a RandomForests model on the input data. """</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  Y <span class="op">=</span> Y.fillna(method<span class="op">=</span><span class="st">'ffill'</span>).fillna(method<span class="op">=</span><span class="st">'bfill'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  X_train, Y_train <span class="op">=</span> X, Y</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">123456</span>, n_estimators<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> model.fit(X_train, Y_train)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To perform the forecasting, we need time-based features for dates that are not in our dataset. Let us use the <code>tk.future_frame</code> method to add future dates to our dataset. We then apply the <code>augment_timeseries_signature</code> method on the resulting DataFrame, hence creating the time-based features for past and future dates:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>date_col<span class="op">=</span> <span class="st">'Date'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>X_time_future <span class="op">=</span> sales_df.drop_duplicates(subset<span class="op">=</span>[<span class="st">'Date'</span>])[[<span class="st">'Date'</span>]]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>X_time_future <span class="op">=</span> X_time_future.future_frame(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    date_column <span class="op">=</span> date_col,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    length_out  <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>).augment_timeseries_signature(date_column <span class="op">=</span> date_col).drop(columns<span class="op">=</span>[date_col])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>X_time_future <span class="op">=</span> dummify(X_time_future, date_col<span class="op">=</span><span class="st">'Date'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>X_time_future.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date_index_num</th>
<th data-quarto-table-cell-role="th">Date_yearstart</th>
<th data-quarto-table-cell-role="th">Date_yearend</th>
<th data-quarto-table-cell-role="th">Date_leapyear</th>
<th data-quarto-table-cell-role="th">Date_half</th>
<th data-quarto-table-cell-role="th">Date_quarter</th>
<th data-quarto-table-cell-role="th">Date_quarterstart</th>
<th data-quarto-table-cell-role="th">Date_quarterend</th>
<th data-quarto-table-cell-role="th">Date_month</th>
<th data-quarto-table-cell-role="th">Date_monthstart</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_December</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_February</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_January</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_July</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_June</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_March</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_May</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_November</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_October</th>
<th data-quarto-table-cell-role="th">Date_month_lbl_September</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1265328000</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1265932800</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1266537600</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1267142400</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1267747200</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>5 rows √ó 55 columns</p>
</div>
</div>
</div>
<p>In the same way, we augment our target DataFrame by 60 weeks. A we don‚Äôt know the sales in the future, the additional rows will be filled with nans. We will replace the nans by our predictions in following the tutorial.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Y_future <span class="op">=</span> sales_df[[<span class="st">'Dept'</span>, <span class="st">'Date'</span>, <span class="st">'Weekly_Sales'</span>]]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Y_future <span class="op">=</span> Y_future.groupby(<span class="st">'Dept'</span>).future_frame(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    date_column <span class="op">=</span> date_col,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    length_out  <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Y_future.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dept</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Weekly_Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2010-02-05</td>
<td>24924.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2010-02-12</td>
<td>46039.49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2010-02-19</td>
<td>41595.55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>2010-02-26</td>
<td>19403.54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>2010-03-05</td>
<td>21827.90</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We train the model and store its predictions on the future dates:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> train_final(X_time_future.iloc[:<span class="bu">len</span>(Y)], Y)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> model.predict(X_time_future.iloc[<span class="bu">len</span>(Y):])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We store the predictions in the Y DataFrame, and tag the prediction entries with the label ‚ÄòPredictions‚Äô. Original entries are tagged with the label <code>History</code>.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Y_future.loc[Y_future.Date <span class="op">&gt;</span> Y.index[<span class="op">-</span><span class="dv">1</span>], <span class="st">'Weekly_Sales'</span>] <span class="op">=</span> predictions.T.ravel()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Y_future[<span class="st">'Label'</span>] <span class="op">=</span> <span class="st">'History'</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>Y_future.loc[Y_future.Date <span class="op">&gt;</span> Y.index[<span class="op">-</span><span class="dv">1</span>], <span class="st">'Label'</span>] <span class="op">=</span> <span class="st">'Predictions'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now plot the result very easily using the <code>plot_timeseries</code> method. Note how you can easily select a subset of the data (the data of a given department) using the <code>query</code> method:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Y_future.query(<span class="st">"Dept == 1"</span>).plot_timeseries(date_column<span class="op">=</span><span class="st">'Date'</span>, value_column<span class="op">=</span><span class="st">'Weekly_Sales'</span>, color_column<span class="op">=</span><span class="st">'Label'</span>, smooth<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="2c2bac02-6fa9-43b8-92c9-37b16940d463" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("2c2bac02-6fa9-43b8-92c9-37b16940d463")) {                    Plotly.newPlot(                        "2c2bac02-6fa9-43b8-92c9-37b16940d463",                        [{"legendgroup":"History","line":{"color":"rgba(44, 62, 80, 1.0)","width":0.65},"mode":"lines","name":"History","x":["2010-02-05T00:00:00","2010-02-12T00:00:00","2010-02-19T00:00:00","2010-02-26T00:00:00","2010-03-05T00:00:00","2010-03-12T00:00:00","2010-03-19T00:00:00","2010-03-26T00:00:00","2010-04-02T00:00:00","2010-04-09T00:00:00","2010-04-16T00:00:00","2010-04-23T00:00:00","2010-04-30T00:00:00","2010-05-07T00:00:00","2010-05-14T00:00:00","2010-05-21T00:00:00","2010-05-28T00:00:00","2010-06-04T00:00:00","2010-06-11T00:00:00","2010-06-18T00:00:00","2010-06-25T00:00:00","2010-07-02T00:00:00","2010-07-09T00:00:00","2010-07-16T00:00:00","2010-07-23T00:00:00","2010-07-30T00:00:00","2010-08-06T00:00:00","2010-08-13T00:00:00","2010-08-20T00:00:00","2010-08-27T00:00:00","2010-09-03T00:00:00","2010-09-10T00:00:00","2010-09-17T00:00:00","2010-09-24T00:00:00","2010-10-01T00:00:00","2010-10-08T00:00:00","2010-10-15T00:00:00","2010-10-22T00:00:00","2010-10-29T00:00:00","2010-11-05T00:00:00","2010-11-12T00:00:00","2010-11-19T00:00:00","2010-11-26T00:00:00","2010-12-03T00:00:00","2010-12-10T00:00:00","2010-12-17T00:00:00","2010-12-24T00:00:00","2010-12-31T00:00:00","2011-01-07T00:00:00","2011-01-14T00:00:00","2011-01-21T00:00:00","2011-01-28T00:00:00","2011-02-04T00:00:00","2011-02-11T00:00:00","2011-02-18T00:00:00","2011-02-25T00:00:00","2011-03-04T00:00:00","2011-03-11T00:00:00","2011-03-18T00:00:00","2011-03-25T00:00:00","2011-04-01T00:00:00","2011-04-08T00:00:00","2011-04-15T00:00:00","2011-04-22T00:00:00","2011-04-29T00:00:00","2011-05-06T00:00:00","2011-05-13T00:00:00","2011-05-20T00:00:00","2011-05-27T00:00:00","2011-06-03T00:00:00","2011-06-10T00:00:00","2011-06-17T00:00:00","2011-06-24T00:00:00","2011-07-01T00:00:00","2011-07-08T00:00:00","2011-07-15T00:00:00","2011-07-22T00:00:00","2011-07-29T00:00:00","2011-08-05T00:00:00","2011-08-12T00:00:00","2011-08-19T00:00:00","2011-08-26T00:00:00","2011-09-02T00:00:00","2011-09-09T00:00:00","2011-09-16T00:00:00","2011-09-23T00:00:00","2011-09-30T00:00:00","2011-10-07T00:00:00","2011-10-14T00:00:00","2011-10-21T00:00:00","2011-10-28T00:00:00","2011-11-04T00:00:00","2011-11-11T00:00:00","2011-11-18T00:00:00","2011-11-25T00:00:00","2011-12-02T00:00:00","2011-12-09T00:00:00","2011-12-16T00:00:00","2011-12-23T00:00:00","2011-12-30T00:00:00","2012-01-06T00:00:00","2012-01-13T00:00:00","2012-01-20T00:00:00","2012-01-27T00:00:00","2012-02-03T00:00:00","2012-02-10T00:00:00","2012-02-17T00:00:00","2012-02-24T00:00:00","2012-03-02T00:00:00","2012-03-09T00:00:00","2012-03-16T00:00:00","2012-03-23T00:00:00","2012-03-30T00:00:00","2012-04-06T00:00:00","2012-04-13T00:00:00","2012-04-20T00:00:00","2012-04-27T00:00:00","2012-05-04T00:00:00","2012-05-11T00:00:00","2012-05-18T00:00:00","2012-05-25T00:00:00","2012-06-01T00:00:00","2012-06-08T00:00:00","2012-06-15T00:00:00","2012-06-22T00:00:00","2012-06-29T00:00:00","2012-07-06T00:00:00","2012-07-13T00:00:00","2012-07-20T00:00:00","2012-07-27T00:00:00","2012-08-03T00:00:00","2012-08-10T00:00:00","2012-08-17T00:00:00","2012-08-24T00:00:00","2012-08-31T00:00:00","2012-09-07T00:00:00","2012-09-14T00:00:00","2012-09-21T00:00:00","2012-09-28T00:00:00","2012-10-05T00:00:00","2012-10-12T00:00:00","2012-10-19T00:00:00","2012-10-26T00:00:00"],"y":[24924.5,46039.49,41595.55,19403.54,21827.9,21043.39,22136.64,26229.21,57258.43,42960.91,17596.96,16145.35,16555.11,17413.94,18926.74,14773.04,15580.43,17558.09,16637.62,16216.27,16328.72,16333.14,17688.76,17150.84,15360.45,15381.82,17508.41,15536.4,15740.13,15793.87,16241.78,18194.74,19354.23,18122.52,20094.19,23388.03,26978.34,25543.04,38640.93,34238.88,19549.39,19552.84,18820.29,22517.56,31497.65,44912.86,55931.23,19124.58,15984.24,17359.7,17341.47,18461.18,21665.76,37887.17,46845.87,19363.83,20327.61,21280.4,20334.23,20881.1,20398.09,23873.79,28762.37,50510.31,41512.39,20138.19,17235.15,15136.78,15741.6,16434.15,15883.52,14978.09,15682.81,15363.5,16148.87,15654.85,15766.6,15922.41,15295.55,14539.79,14689.24,14537.37,15277.27,17746.68,18535.48,17859.3,18337.68,20797.58,23077.55,23351.8,31579.9,39886.06,18689.54,19050.66,20911.25,25293.49,33305.92,45773.03,46788.75,23350.88,16567.69,16894.4,18365.1,18378.16,23510.49,36988.49,54060.1,20124.22,20113.03,21140.07,22366.88,22107.7,28952.86,57592.12,34684.21,16976.19,16347.6,17147.44,18164.2,18517.79,16963.55,16065.49,17666.0,17558.82,16633.41,15722.82,17823.37,16566.18,16348.06,15731.18,16628.31,16119.92,17330.7,16286.4,16680.24,18322.37,19616.22,19251.5,18947.81,21904.47,22764.01,24185.27,27390.81],"type":"scatter","hoverlabel":{"font":{"size":8.8}}},{"legendgroup":"Predictions","line":{"color":"rgba(227, 26, 28, 1.0)","width":0.65},"mode":"lines","name":"Predictions","x":["2012-11-02T00:00:00","2012-11-09T00:00:00","2012-11-16T00:00:00","2012-11-23T00:00:00","2012-11-30T00:00:00","2012-12-07T00:00:00","2012-12-14T00:00:00","2012-12-21T00:00:00","2012-12-28T00:00:00","2013-01-04T00:00:00","2013-01-11T00:00:00","2013-01-18T00:00:00","2013-01-25T00:00:00","2013-02-01T00:00:00","2013-02-08T00:00:00","2013-02-15T00:00:00","2013-02-22T00:00:00","2013-03-01T00:00:00","2013-03-08T00:00:00","2013-03-15T00:00:00","2013-03-22T00:00:00","2013-03-29T00:00:00","2013-04-05T00:00:00","2013-04-12T00:00:00","2013-04-19T00:00:00","2013-04-26T00:00:00","2013-05-03T00:00:00","2013-05-10T00:00:00","2013-05-17T00:00:00","2013-05-24T00:00:00","2013-05-31T00:00:00","2013-06-07T00:00:00","2013-06-14T00:00:00","2013-06-21T00:00:00","2013-06-28T00:00:00","2013-07-05T00:00:00","2013-07-12T00:00:00","2013-07-19T00:00:00","2013-07-26T00:00:00","2013-08-02T00:00:00","2013-08-09T00:00:00","2013-08-16T00:00:00","2013-08-23T00:00:00","2013-08-30T00:00:00","2013-09-06T00:00:00","2013-09-13T00:00:00","2013-09-20T00:00:00","2013-09-27T00:00:00","2013-10-04T00:00:00","2013-10-11T00:00:00","2013-10-18T00:00:00","2013-10-25T00:00:00","2013-11-01T00:00:00","2013-11-08T00:00:00","2013-11-15T00:00:00","2013-11-22T00:00:00","2013-11-29T00:00:00","2013-12-06T00:00:00","2013-12-13T00:00:00","2013-12-20T00:00:00"],"y":[27060.95239999993,22754.01489999997,22152.94699999999,28308.149533333337,22861.78803333331,26810.763333333332,31856.940599999987,42698.00540000008,29250.730199999995,29793.217833333383,26097.881033333382,26326.0372,21121.964866666687,27630.702033333408,31850.465533333365,35316.349533333305,21701.178633333362,24131.825133333416,24409.876100000045,24323.592166666665,21730.803033333374,22725.996966666713,34312.51853333331,26472.2855,22445.50466666668,20733.991233333305,18951.341933333384,19291.097666666712,19456.512233333357,18649.565366666648,19983.00766666666,18328.281566666712,18179.86273333334,18440.501300000014,18341.026599999997,20599.532100000048,18605.00016666666,17707.738099999973,17218.954666666672,16332.05716666664,16102.93413333334,16378.433566666701,15797.391633333347,16105.76076666676,19295.784200000024,19459.0559,19431.37059999999,19447.060833333286,22998.285199999984,21320.450333333276,21826.08843333326,25548.263599999922,26971.745099999942,22837.605333333315,22036.796499999993,27970.818533333342,23722.408933333318,25955.67953333334,30734.980766666675,41740.40973333337],"type":"scatter","hoverlabel":{"font":{"size":8.8}}}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":""},"tickformat":"%b %Y","showticklabels":true,"visible":true,"tickfont":{"size":8.8}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":""},"tickfont":{"size":8.8}},"legend":{"title":{"text":"Legend","font":{"size":8.8}},"font":{"size":8.8}},"title":{"text":"Time Series Plot","font":{"size":13.2}},"margin":{"l":10,"r":10,"t":40,"b":40},"font":{"size":11},"autosize":true},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('2c2bac02-6fa9-43b8-92c9-37b16940d463');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
</section>
<section id="conclusion" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Conclusion</h1>
<p>In this tutorial, we showed how the <code>tk.augment_timeseries_signature()</code> function can be used to effortlessly extract useful features from the date index and perform forecasting.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../tutorials/02_finance.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Finance and Investment Analysis</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tutorials/04_anomaly_detection.html" class="pagination-link">
        <span class="nav-page-text">Anomaly Detection</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>